<!DOCTYPE html>
<html>

<head>
  <title>Simple Map</title>
  <meta name="viewport" content="initial-scale=1.0">
  <meta charset="utf-8">
  <link href="https://fonts.googleapis.com/css?family=Lato:300,400" rel="stylesheet">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="index.css">
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.compatibility.js"></script>


</head>

<body>
  <div class="jumbotron">
    <h1>WeCycle</h1>
    <h3 style="margin-top:20px; font-family: Lato;">A tool to help you find the easiest cycling route </h3>
  </div>
  <div class="container">
    <div class="row first">
      <div class="col-md-12">
        <h3> Where are you heading from today?</h3>
      </div>
      <div class="col-lg-6 offset-lg-3">
        <div class="input-group" style="text-align:center">
          <input type="text" class="form-control" style="text-align:center" id="start_address" placeholder="Enter your pin code here">
          <!-- <span class="input-group-btn">
              <button class="btn btn-secondary" type="button">Go!</button>
            </span> -->
          <button class="btn btn-outline-primary" id="btn2" onclick="getStartLocationByPin()" style="width:20%; margin-left:30px;"> Go!</button>
        </div>
      </div>
    </div>



    <div class="row second" id="second" style="display:none;">
      <div class="col-md-12">
        <h3> What's your weight range?</h3>
      </div>
      <div class="col-md-12 col-sm-12" style="margin-top:40px;">
        <div class="form-check form-check-inline">
          <label class="css-label cb3">
            <input type="radio" data-required="true" name="radio" id="1" class="" value="50-54">
            50 - 54
          </label>
        </div>
        <div class="form-check form-check-inline">
          <label class="css-label cb3">
            <input type="radio" data-required="true" name="radio" id="1" class="" value="55-59">
            55 - 59
          </label>
        </div>
        <div class="form-check form-check-inline">
          <label class="css-label cb3">
            <input type="radio" data-required="true" name="radio" id="1" class="" value="60-64">
            60 - 64
          </label>
        </div>
        <div class="form-check form-check-inline">
          <label class="css-label cb3">
            <input type="radio" data-required="true" name="radio" id="1" class="" value="65-69">
            65 - 69
          </label>
        </div>
        <div class="form-check form-check-inline">
          <label class="css-label cb3">
            <input type="radio" data-required="true" name="radio" id="1" class="" value="70-74">
            70 - 74
          </label>
        </div>
        <div class="form-check form-check-inline">
          <label class="css-label cb3">
            <input type="radio" data-required="true" name="radio" id="1" class="" value="75-79">
            75 - 79
          </label>
        </div>
        <div class="form-check form-check-inline">
          <label class="css-label cb3">
            <input type="radio" data-required="true" name="radio" id="1" class="" value="80-84">
            80 - 84
          </label>
        </div>
        <div class="form-check form-check-inline">
          <label class="css-label cb3">
            <input type="radio" data-required="true" name="radio" id="1" class="" value="85-89">
            84 - 89
          </label>
        </div>
        <div class="form-check form-check-inline">
          <label class="css-label cb3">
            <input type="radio" data-required="true" name="radio" id="1" class="" value="90-94">
            90 - 94
          </label>
        </div>
        <div class="form-check form-check-inline">
          <label class="css-label cb3">
            <input type="radio" data-required="true" name="radio" id="1" class="" value="95-99">
            95 - 99
          </label>
        </div>
        <div class="form-check form-check-inline">
          <label class="css-label cb3">
            <input type="radio" data-required="true" name="radio" id="1" class="" value=">100">
            >100
          </label>
        </div>
      </div>
    </div>

    <div class="row third" id="third" style="display:none;">
      <div class="col-md-12">
        <h3> What's your destination?</h3>
      </div>
      <div class="col-lg-6 offset-lg-3 col-sm-12">
        <div class="input-group" style="text-align:center">
          <input type="text" class="form-control" id="end_address" placeholder="Enter your destination's Pin Code here!">
          <!-- <span class="input-group-btn">
                <button class="btn btn-secondary" type="button">Go!</button>
              </span> -->
          <button class="btn btn-outline-primary" id="btn-3" onclick="getEndLocation()" style="width:20%; margin-left:30px;"> Go!</button>
        </div>
      </div>
    </div>

    <div class="row fourth" id="fourth" style="display:none;">
      <div class="col-md-12" margin-top="margin-top:20px;">
        <h3> Here's the elevation you'll face.</h3>
      </div>
      <div class="col-md-8 col-offset-md-2 justify-content-center">
        <div class="input-group" style="margin-left:150px;width:100%;">

        </div>
        <div class="justify-content-center" id="graph" style="width:100%; margin-left:200px;"></div>
        <div class="col-md-10 offset-md-6 justify-content-center" style="margin-top:50px">
          <h3> Scroll down to get geared up.</h3>
        </div>

      </div>


    </div>
    <div class="col-md-12" style="margin-bottom:40px; height:500px; width:100%; margin-top:50px;" id="map_id"></div>
    <div class="row">
      <div class="col-md-12">
        <h3> Gear Changes for the journey.</h3>
      </div>
      <div class="col-md-6" style="margin-top:50px;">
        <h5> For this journey, we recommend the following gear levels </h5>
        <div id="gearlevel"></div>
      </div>
      <div class="col-md-6" style="margin-top:50px;">
        <h5> Reference Data </h5>
        <table class="table table-striped">
          <thead>
            <tr>
              <th>Group</th>
              <th>7 Gears</th>
              <th>14 Gears</th>
              <th>21 Gears</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <th scope="row">Very High</th>
              <td>6-7</td>
              <td>12-14</td>
              <td>16-21</td>
            </tr>
            <tr>
              <th scope="row">High</th>
              <td>4-5</td>
              <td>9-11</td>
              <td>11-16</td>
            </tr>
            <tr>
              <th scope="row">Medium-Low</th>
              <td>2-3</td>
              <td>4-9</td>
              <td>5-10</td
            </tr>
            <tr>
              <th scope="row">Very Low</th>
              <td>1</td>
              <td>1-3</td>
              <td>1-4</td>

            </tr>
          </tbody>
        </table>
    </div>
  </div>


  <script>
    // $('#btn1').on('click', function(){
    //  $('#second').show('slow');
    //  $('html, body').animate({
    //     scrollTop: $("#second").offset().top
    // }, 1500);
    //   });
    // var x = document.getElementById("demo");

    var start
    var end
    var map;

    function initMap() {
      map = new google.maps.Map(document.getElementById('map_id'), {
        zoom: 12,
        center: {
          lat: 1.340165306,
          lng: 103.675497298
        },
        mapTypeId: 'terrain'
      });
      google.maps.event.addListenerOnce(map, 'idle', function() {
        google.maps.event.trigger(map, 'resize');
      });
    }

    function getStartLocationByPrompt() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition);
      } else {
        x.innerHTML = "Could not get current location";
      }
    }

    function getStartLocationByPin() {
      $('#second').show('slow');
      $('html, body').animate({
        scrollTop: $("#second").offset().top
      }, 1500);
      var start_address = document.getElementById('start_address').value;

      var geocoder = new google.maps.Geocoder();
      geocoder.geocode({
        'address': start_address
      }, function(results, status) {
        if (status == google.maps.GeocoderStatus.OK) {
          // start : {lat= results[0].geometry.viewport.b.b , lng=results[0].geometry.viewport.f.b}
          var s_lat = results[0].geometry.viewport.b.b;
          var s_lng = results[0].geometry.viewport.f.b;
          start = {
            lat: s_lng,
            lng: s_lat
          }
          console.log(start)
        }
      });

    }
    var range
    $("input[name='radio']").on("change", function() {
      console.log("Weight range: " + this.value)
      range = this.value;
      $('#third').show('slow');
      $('html, body').animate({
        scrollTop: $("#third").offset().top
      }, 1500);
    });



    function getEndLocation() {
      $('#fourth').show('slow');
      $('html, body').animate({
        scrollTop: $("#fourth").offset().top
      }, 1500);
      var end_address = document.getElementById('end_address').value;
      var geocoder = new google.maps.Geocoder();
      geocoder.geocode({
        'address': end_address
      }, function(results, status) {
        if (status == google.maps.GeocoderStatus.OK) {
          // start : {lat= results[0].geometry.viewport.b.b , lng=results[0].geometry.viewport.f.b}
          var e_lat = results[0].geometry.viewport.b.b;
          var e_lng = results[0].geometry.viewport.f.b;
          end = {
            lat: e_lng,
            lng: e_lat
          }
          console.log(end)
          var path = [start, end]
          console.log(path)
          var elevator = new google.maps.ElevationService;
          var elevated_path
          elevator.getElevationAlongPath({
            'path': path,
            'samples': 60
          }, function(results) {
            elevated_path = results;
            var elevated_path_x = []
            var elevated_path_y = []

            for (y in elevated_path) {
              elevated_path_y.push(elevated_path[y].elevation)
            }
            console.log(elevated_path_y)
            var i = 0;
            var len = elevated_path_y.length;
            for (i; i < len; i++) {
              elevated_path_x.push(i)
            }

            console.log(elevated_path_x)
            var service = new google.maps.DistanceMatrixService();
            service.getDistanceMatrix({
              origins: [start],
              destinations: [end],
              travelMode: 'WALKING'
            }, callback);
            var angles = []
            var rad

            function callback(response, status) {
              var distance = Number(response.rows["0"].elements["0"].distance.value) / 60
              console.log("Total distance " + distance * 60);
              console.log("Distance between points " + distance)

              var calculated_vals = []

              var i = 0;
              var len = elevated_path_y.length;
              for (i; i < len; i++) {
                var diff = elevated_path_y[i + 1] - elevated_path_y[i]
                // console.log(diff)
                calculated_vals.push(diff)
              }
              calculated_vals[59] = calculated_vals[58]
              // console.log(calculated_vals)


              for (x in calculated_vals) {
                rad = calculated_vals[x] / distance
                rad = rad * 180
                rad = rad / Math.PI
                angles.push(rad)
              }

              console.log(angles)
              var gear_levels = {
                very_high: 0,
                high: 0,
                medium_low: 0,
                very_low: 0
              }
              console.log(gear_levels)
              for (x in angles) {
                if (range == "50-54") {
                  if (angles[x] < 1) {
                    // console.log("Very High")
                    // $( "#gearlevel" ).append("<p>Very High</p>"  );
                    gear_levels.very_high += 1
                  } else if (1 <= angles[x] <= 11) {
                    gear_levels.high += 1
                  } else {
                    gear_levels.medium_low += 1
                  }
                } else if (range == "55-59") {
                  if (angles[x] < 2) {
                    // console.log("Very High")
                    // $( "#gearlevel" ).append("<p>Very High</p>"  );
                    gear_levels.high += 1
                  } else if (2 <= angles[x] <= 21) {
                    gear_levels.medium_low += 1
                  } else {
                    gear_levels.very_low += 1
                  }
                } else if (range == "60-64") {
                  if (angles[x] < 3) {
                    // console.log("Very High")
                    // $( "#gearlevel" ).append("<p>Very High</p>"  );
                    gear_levels.very_high += 1
                  } else if (3 <= angles[x] <= 14) {
                    gear_levels.high += 1
                  } else {
                    gear_levels.medium_low += 1
                  }
                } else if (range == "65-69") {
                  if (angles[x] < 3) {
                    // console.log("Very High")
                    // $( "#gearlevel" ).append("<p>Very High</p>"  );
                    gear_levels.very_high += 1
                  } else if (3 <= angles[x] <= 15) {
                    gear_levels.high += 1
                  } else {
                    gear_levels.medium_low += 1
                  }
                } else if (range == "70-74") {
                  if (angles[x] < 4) {
                    // console.log("Very High")
                    // $( "#gearlevel" ).append("<p>Very High</p>"  );
                    gear_levels.very_high += 1
                  } else if (4 <= angles[x] <= 16) {
                    gear_levels.high += 1
                  } else {
                    gear_levels.medium_low += 1
                  }
                } else if (range == "75-79") {
                  if (angles[x] < 5) {
                    // console.log("Very High")
                    // $( "#gearlevel" ).append("<p>Very High</p>"  );
                    gear_levels.very_high += 1
                  } else if (5 <= angles[x] <= 18) {
                    gear_levels.high += 1
                  } else {
                    gear_levels.medium_low += 1
                  }
                } else if (range == "80-84") {
                  if (angles[x] < 5) {
                    // console.log("Very High")
                    // $( "#gearlevel" ).append("<p>Very High</p>"  );
                    gear_levels.very_high += 1
                  } else if (5 <= angles[x] <= 18) {
                    gear_levels.high += 1
                  } else {
                    gear_levels.medium_low += 1
                  }
                } else if (range == "85-89") {
                  if (angles[x] < 6) {
                    // console.log("Very High")
                    // $( "#gearlevel" ).append("<p>Very High</p>"  );
                    gear_levels.very_high += 1
                  } else if (6 <= angles[x] <= 19) {
                    gear_levels.high += 1
                  } else {
                    gear_levels.medium_low += 1
                  }
                } else if (range == "90-94") {
                  if (angles[x] < 6) {
                    // console.log("Very High")
                    // $( "#gearlevel" ).append("<p>Very High</p>"  );
                    gear_levels.very_high += 1
                  } else if (6 <= angles[x] <= 20) {
                    gear_levels.high += 1
                  } else {
                    gear_levels.medium_low += 1
                  }
                } else if (range == "95-99") {
                  if (angles[x] < 7) {
                    // console.log("Very High")
                    // $( "#gearlevel" ).append("<p>Very High</p>"  );
                    gear_levels.very_high += 1
                  } else if (7 <= angles[x] <= 21) {
                    gear_levels.high += 1
                  } else {
                    gear_levels.medium_low += 1
                  }
                } else if (range == ">100") {
                  if (angles[x] < 7) {
                    // console.log("Very High")
                    // $( "#gearlevel" ).append("<p>Very High</p>"  );
                    gear_levels.very_high += 1
                  } else if (7 <= angles[x] <= 22) {
                    gear_levels.high += 1
                  } else {
                    gear_levels.medium_low += 1
                  }
                }
              }
              console.log(gear_levels)
              if(gear_levels.very_high > 0){
                $( "#gearlevel" ).append("<p>Very High</p>");
              }
              if(gear_levels.high > 0){
                $( "#gearlevel" ).append("<p>High</p>");
              }
              if(gear_levels.medium_low > 0){
                $( "#gearlevel" ).append("<p>Medium-Low</p>");
              }
              if(gear_levels.very_low > 0){
                $( "#gearlevel" ).append("<p>Very Low</p>");
              }
            }
            var trace = {
              x: elevated_path_x,
              y: elevated_path_y,
              type: 'scatter'
            };
            layout = {
              hovermode: 'closest',
              title: " Terrain Elevation en route",
              xaxis: {
                zeroline: false,
                title: 'Arbitrary Units'
              },
              yaxis: {
                zeroline: false,
                title: 'Elevation'
              },
              yaxis: {
                range: [0, Math.max(elevated_path_y) + 10]
              },
            };

            var data = [trace];
            Plotly.newPlot('graph', data, layout);

            // console.log(range);

            var start_marker = new google.maps.Marker({
              position: start,
              map: map
            });
            var end_marker = new google.maps.Marker({
              position: end,
              map: map
            });
            map.setCenter(path[0]);

            var request = {
              origin: start,
              destination: end,
              travelMode: 'WALKING'
            }
            var directionsDisplay
            var directionsService = new google.maps.DirectionsService();
            directionsService.route(request, function(result, status) {
              if (status == 'OK') {
                console.log(result);
                directionsDisplay = new google.maps.DirectionsRenderer();
                directionsDisplay.setMap(map);
                directionsDisplay.setDirections(result);
              }
            });
            var flightPath = new google.maps.Polyline({
              path: [start, end],
              geodesic: true,
              strokeColor: '#FF0000',
              strokeOpacity: 1.0,
              strokeWeight: 2
            });


            flightPath.setMap(map);
            $( "#gearlevel" ).append(  );



          });



          //  elevator.getElevationForLocations({
          //    'locations': path
          //  }, function(results, status){
          //    if (status === 'OK') {
          //      console.log(results)
          //    }
          //  })
        }
      });


    }

    function showPosition(position) {
      var geocoder = new google.maps.Geocoder();
      var start_address = {
        lat: position.coords.latitude,
        lng: position.coords.longitude
      }
      // console.log(start)
      $('#second').show('slow');
      $('html, body').animate({
        scrollTop: $("#second").offset().top
      }, 1500);
    }
  </script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.js"></script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAwY09qNEww0J-3pVeeI2y07uvEsefm7uQ&callback=initMap" async defer></script>
</body>

</html>
